#!/usr/bin/env python
# coding: utf-8

# KiriKiri .XP3 archive extraction tool
#
#   Extracts an .XP3 archive to a directory of files, including any
# subdirectory structure.  Does aggressive error-checking, so some
# assertions may have to be disabled with nonstandard XP3 files.
#
#   Optionally handles Fate Stay Night encryption.
#
# Last modified 2006-07-08, Edward Keyes, ed-at-insani-dot-org
# more encryption methods added by jpnoob in 2021:
# hare tokidoki otenkiame (dl)

import sys, os, zlib
from array import array
from cStringIO import StringIO
from insani import *

if len(sys.argv) not in (3,4) :
  print 'usage: xp3-extract.py archive-filename output-dir [encryption]'
  print 'encryption is one of the following:'
  print '  fate_trial'
  print '  fate_full'
  print '  hareten_dl: hare tokidoki otenkiame (download edition)'
  sys.exit(0)

def read_entry(infile) :
# Reads a file entry and creates a data structure from it.
   result = {}
   startpos=infile.tell()
   assert_string(infile,'File',ERROR_ABORT)
   entrylength = read_unsigned(infile,LONG_LENGTH)
   endpos=infile.tell()+entrylength
   ignored=0
   while infile.tell()<endpos:
     section = ''
     for i in xrange(4):section+=chr(read_unsigned(infile,1))
     infolength = read_unsigned(infile,LONG_LENGTH)
     if section=='adlr':
       assert(infolength==4)
       result['adler'] = read_unsigned(infile)      
     elif section=='segm':
       numsegments = infolength // 28   # 28 bytes per seg.
       result['segments'] = []
       compsize = origsize = 0
       for i in xrange(numsegments) :
          segment = {}
          segment['compressed'] = read_unsigned(infile)
          segment['offset'] = read_unsigned(infile,LONG_LENGTH)
          segment['origsize'] = read_unsigned(infile,LONG_LENGTH)
          segment['compsize'] = read_unsigned(infile,LONG_LENGTH)
          compsize += segment['compsize']
          origsize += segment['origsize']
          result['segments'].append(segment)
     elif section=='info':
       result['encrypted'] = read_unsigned(infile)
       result['origsize'] = read_unsigned(infile,LONG_LENGTH)
       result['compsize'] = read_unsigned(infile,LONG_LENGTH)
       filenamelength = read_unsigned(infile,SHORT_LENGTH)
       result['filepath'] = u''
       for i in xrange(filenamelength) :
          result['filepath'] += unichr(read_unsigned(infile,SHORT_LENGTH))
       extra=0
       while filenamelength*2+22+extra<infolength:
         extra+=1
         throw=read_unsigned(infile,1)
       assert (infolength == filenamelength*2+22 or infolength == filenamelength*2+24)
     else:
       throw=read_unsigned(infile,infolength)
       ignored=1
   print result
   # that fileentry with super-long filename with warning is borked
   assert (compsize == result['compsize'] or filenamelength>200)
   assert (origsize == result['origsize'] or filenamelength>200)
   # if some sections were ignored we can't assert on length
   assert (ignored>0 or entrylength == filenamelength*2+numsegments*28+62 or entrylength == filenamelength*2+numsegments*28+64)
   return result

# start of cxdecrypt
# based on:
# https://github.com/morkt/GARbro/blob/master/ArcFormats/KiriKiri/KiriKiriCx.cs

def cx_getval32(program,i):
  par1=program[i]
  par2=program[i+1]
  par3=program[i+2]
  par4=program[i+3]
  return par1+(par2<<8)+(par3<<16)+(par4<<24)

def cx_execute(program,hash):
  hash&=0xffffffff
  # i don't think the value of ecx before call matters
  eax=edx=ecx=edi=esi=ip=0
  ebx=hash
  stack=[]
  while 1:
    cmd=program[ip]
    if ip+1<len(program):cmd2=program[ip+1]
    else: cmd2=-1
    if ip+2<len(program):cmd3=program[ip+2]
    else: cmd3=-1
    if cmd==0x40:eax=(eax+1)&0xffffffff;ip+=1 # inc eax
    elif cmd==0x48:eax=(eax-1)&0xffffffff;ip+=1 # dec eax
    elif cmd==0x51:stack.append(ecx);ip+=1 # push ecx
    elif cmd==0x52:stack.append(edx);ip+=1 # push edx
    elif cmd==0x53:stack.append(ebx);ip+=1 # push ebx
    elif cmd==0x56:stack.append(esi);ip+=1 # push esi
    elif cmd==0x57:stack.append(edi);ip+=1 # push edi
    elif cmd==0x59:ecx=stack.pop();ip+=1 # pop ecx
    elif cmd==0x5a:edx=stack.pop();ip+=1 # pop edx
    elif cmd==0x5b:ebx=stack.pop();ip+=1 # pop ebx
    elif cmd==0x5e:esi=stack.pop();ip+=1 # pop esi
    elif cmd==0x5f:edi=stack.pop();ip+=1 # pop edi
    elif cmd==0xc3: # ret
      if ip+1!=len(program):print 'program ended prematurely'
      break
    # 2-byte commands
    elif cmd==0x01 and cmd2==0xd8:eax=(eax+ebx)&0xffffffff;ip+=2 # add eax,ebx
    elif cmd==0x09 and cmd2==0xd8:eax=(eax|ebx)&0xffffffff;ip+=2 # or eax,ebx
    elif cmd==0x29 and cmd2==0xd8:eax=(eax-ebx)&0xffffffff;ip+=2 # sub eax,ebx
    elif cmd==0x89 and cmd2==0xc3:ebx=eax;ip+=2 # mov ebx,eax
    elif cmd==0x89 and cmd2==0xd9:ecx=ebx;ip+=2 # mov ecx,ebx
    elif cmd==0x8b and cmd2==0xc7:eax=edi;ip+=2 # mov eax,edi
    elif cmd==0xd1 and cmd2==0xe0:eax=(eax<<1)&0xffffffff;ip+=2 # shl eax,1
    elif cmd==0xd1 and cmd2==0xeb:ebx=ebx>>1;ip+=2 # shr ebx,1
    elif cmd==0xd3 and cmd2==0xe0:eax=(eax<<(ecx&255))&0xffffffff;ip+=2 # shl eax,cl
    elif cmd==0xd3 and cmd2==0xe8:eax>>=(ecx&255);ip+=2 # shr eax,cl
    elif cmd==0xf7 and cmd2==0xd0:eax=(~eax)&0xffffffff;ip+=2 # not eax
    elif cmd==0xf7 and cmd2==0xd8:eax=(-eax)&0xffffffff;ip+=2 # neg eax
    # 3-byte commands
    elif cmd==0x0f and cmd2==0xaf and cmd3==0xc3:eax=(eax*ebx)&0xffffffff;ip+=3 # imul eax,ebx
    elif cmd==0x8b and cmd2==0x04 and cmd3==0x86: # mov eax,dword ptr ds:[esi+eax*4]
      par1=cx_controlblock[eax*4]
      par2=cx_controlblock[eax*4+1]
      par3=cx_controlblock[eax*4+2]
      par4=cx_controlblock[eax*4+3]
      eax=par1+(par2<<8)+(par3<<16)+(par4<<24)
      ip+=3
    # commands with parameters
    elif cmd==0x05:val=cx_getval32(program,ip+1);eax=(eax+val)&0xffffffff;ip+=5 # add eax,immed32
    elif cmd==0x25:val=cx_getval32(program,ip+1);eax&=val;ip+=5 # and eax,immed32
    elif cmd==0x2d:val=cx_getval32(program,ip+1);eax=(eax-val)&0xffffffff;ip+=5 # sub eax,immed32
    elif cmd==0x35:val=cx_getval32(program,ip+1);eax^=val;ip+=5 # xor eax,immed32
    elif cmd==0xb8:val=cx_getval32(program,ip+1);eax=val;ip+=5 # mov eax,immed32
    elif cmd==0xbe: # mov esi,immed32
      val=cx_getval32(program,ip+1)
      if val!=cx_esiaddr:print 'expected '+str(cx_esiaddr)+', got '+str(val)
      esi=val;
      ip+=5
    elif cmd==0x81 and cmd2==0xe3:val=cx_getval32(program,ip+2);ebx&=val;ip+=6 # and ebx,immed32
    elif cmd==0x83 and cmd2==0xe1:par1=program[ip+2];ecx=ecx&par1;ip+=3 # and ecx,immed8
    elif cmd==0x8b and cmd2==0x86: # mov eax,dword ptr ds:[esi+immed32]
      val=cx_getval32(program,ip+2)
      eax=cx_controlblock[val]+(cx_controlblock[val+1]<<8)+(cx_controlblock[val+2]<<16)+(cx_controlblock[val+3]<<24)
      ip+=6
    elif cmd==0x8b and cmd2==0x7c and cmd3==0x24: # mov edi,dword ptr ss:[esp+immed8]
      par1=program[ip+3]
      if par1!=0x18:print 'error, expected ss:[esp+18] instead of '+str(par1)
      edi=hash
      ip+=4
    else:
      print 'unknown command '+str(cmd)+' '+str(cmd2)
      assert 1==2
#    print 'before ip '+hex(ip)+': eax '+hex(eax)+' ebx '+hex(ebx)+' ecx '+hex(ecx)+' edx '+hex(edx)+' esi '+hex(esi)+' edi '+hex(edi)
  if len(stack)>0:print 'stack not empty after program has run'
  return eax

def cx_executexcode(hash):
  seed=hash&0x7f
  hash>>=7
#  print 'seed '+hex(seed)+' hash '+hex(hash)
  return (cx_execute(cx_programlist[seed],hash),cx_execute(cx_programlist[seed],~hash))

def cx_decode(key,offset,buffer,pos,count):
#  print 'decode '+hex(key)+' offset '+hex(offset)+' pos '+hex(pos)+' count '+hex(count)
  (ret1,ret2)=cx_executexcode(key)
#  print 'ret',hex(ret1),hex(ret2)
  key1=ret2>>16
  key2=ret2&0xffff
  key3=ret1&0xff
#  print 'keys '+hex(key1),hex(key2),hex(key3)
  if key1==key2:key2+=1
  if key3==0:key3=1
#  print hex(key1),hex(key2),hex(key3)
  if (key2>=offset) and (key2<offset+count):
#    print 'xor at '+hex(pos+key2-offset)+': '+hex((ret1>>16)&0xff)
    buffer[pos+key2-offset]^=(ret1>>16)&0xff
  if (key1>=offset) and (key1<offset+count):
    buffer[pos+key1-offset]^=(ret1>>8)&0xff
#    print 'xor at '+hex(pos+key1-offset)+': '+hex((ret1>>8)&0xff)
#  print 'xor from pos '+hex(pos)+': '+hex(key3)
  for i in xrange(0,count):buffer[pos+i]^=key3

def cxdecrypt(entry,buffer,cx_mask,cx_offset,offset,count):
  # start
  key=entry['adler']
#  print 'key',hex(key)
  base_offset=(key&cx_mask)+cx_offset
#  print 'base_offset',hex(base_offset)
  pos=0
  # i can't quite tell if this is equivalent to the code in hareten
  # or if the difference between asm and (decompiled) c is just that large
  if offset<base_offset:
    base_length=min(base_offset-offset,count)
    cx_decode(key,0,buffer,0,base_length)
    offset+=base_length
    pos+=base_length
    count-=base_length
  if count>0:
    key=(key>>16)^key
    cx_decode(key,offset,buffer,pos,count)

# end of cxdecrypt

def decrypt(fileentry, outfile, encryption) :
# Performs standard types of XP3 decryption on a file.
   if encryption == 'fate_trial' :
      outfile.seek(0)
      data = array('B',outfile.read())
      for i in xrange(len(data)) :
         data[i] ^= 0x0052
      if len(data)>30 :
         data[30] ^= 0x0001
      if len(data)>55355 :
         data[55355] ^= 0x0020
      outfile.seek(0)
      outfile.write(data.tostring())
   elif encryption == 'fate_full' :   # Not 100% sure about these values.
      outfile.seek(0)
      data = array('B',outfile.read())
      for i in xrange(len(data)) :
         data[i] ^= 0x0036
      if len(data)>19 :
         data[19] ^= 0x0001
      outfile.seek(0)
      outfile.write(data.tostring())
   elif encryption == 'hareten_dl':
      global cx_controlblock,cx_programlist,cx_esiaddr
      cx_controlblock=[101,106,107,136,47,197,183,194,65,74,180,199,83,2,66,152,128,216,58,3,209,60,205,251,116,43,83,133,210,6,121,120,72,170,180,162,226,169,72,157,190,135,5,100,123,84,85,191,125,12,93,59,161,43,230,67,251,246,101,193,59,99,213,164,151,76,219,203,205,237,135,77,146,34,85,157,211,191,37,188,111,129,225,242,120,27,250,169,133,189,79,102,181,145,43,250,150,239,216,176,121,192,145,191,83,68,154,19,85,139,33,142,121,233,74,165,170,101,192,207,21,63,166,87,215,157,158,141,161,23,240,235,104,11,78,136,52,28,112,102,206,156,61,206,192,166,201,86,251,30,165,179,98,169,189,130,184,220,150,191,188,246,34,145,215,69,79,97,18,215,206,176,111,78,225,132,249,118,52,208,203,42,156,15,56,224,223,43,26,198,192,249,125,12,13,92,25,253,95,24,250,221,9,187,123,85,102,65,132,134,68,237,41,242,28,66,72,111,168,236,33,227,96,169,211,158,67,185,150,158,47,140,82,227,239,103,208,11,30,149,230,32,184,7,3,98,221,230,229,215,11,22,192,76,193,253,8,153,65,247,89,148,251,156,71,49,65,127,135,251,233,168,99,227,167,129,218,5,67,170,208,20,219,153,154,0,128,198,74,68,192,183,57,88,9,216,3,93,194,71,64,60,86,105,121,22,74,178,56,223,155,77,95,217,91,118,49,61,64,44,209,90,104,120,117,221,59,1,170,26,70,134,104,107,145,1,7,145,222,134,40,176,128,248,162,126,71,233,124,212,212,190,237,255,121,81,6,127,147,199,96,80,169,189,85,212,75,214,159,71,161,145,44,54,149,203,121,220,187,198,208,3,244,198,221,7,190,10,150,66,43,183,250,136,64,239,145,246,142,136,90,127,86,42,222,178,7,218,24,147,97,111,202,24,174,148,172,204,0,251,8,194,3,211,139,169,197,246,219,228,193,231,170,3,57,49,19,5,52,223,38,120,1,81,49,0,6,57,159,68,76,115,52,177,184,114,228,252,234,192,18,31,80,39,72,75,195,251,152,63,244,211,160,99,191,17,2,85,172,113,224,41,202,4,3,64,13,212,38,6,195,27,136,104,244,193,199,173,37,177,255,65,167,53,74,174,65,164,34,112,228,171,200,218,117,4,100,135,20,23,228,3,251,190,221,67,101,123,21,19,35,32,132,202,254,228,249,44,159,223,222,208,94,90,171,16,195,167,62,241,185,229,163,254,220,119,109,152,28,11,148,32,106,198,170,48,5,87,44,135,136,4,170,127,184,81,195,217,246,235,16,95,120,223,64,84,183,83,242,215,175,203,187,213,42,233,168,41,27,153,157,71,118,76,120,144,90,105,188,44,221,99,138,16,69,215,109,225,6,119,139,218,251,177,58,151,183,4,195,160,245,35,235,70,203,160,127,49,95,199,153,129,197,32,150,7,15,129,53,118,99,32,92,84,190,243,138,191,35,243,162,10,184,47,209,254,58,99,159,128,118,9,22,186,111,3,243,152,219,209,30,237,142,24,63,104,55,37,142,231,116,85,85,129,189,210,2,165,106,8,15,30,227,129,192,241,49,114,211,70,38,37,160,36,61,204,231,184,168,154,17,7,172,184,83,223,219,122,24,150,170,174,173,237,179,61,12,80,7,179,9,197,7,177,42,59,73,251,201,125,30,211,126,224,0,64,101,69,26,31,32,230,58,115,227,244,52,126,159,86,75,89,248,219,21,31,63,219,114,1,188,248,196,161,138,200,174,160,117,122,184,231,171,245,97,192,197,160,64,105,234,171,12,234,99,168,209,240,251,180,205,186,3,164,16,189,193,174,69,125,23,48,133,21,129,97,161,133,228,19,153,142,228,39,254,230,179,89,15,106,90,26,65,67,106,211,111,74,3,37,70,102,171,252,175,75,71,152,131,13,133,108,220,157,142,97,245,74,54,180,94,51,199,172,102,197,123,177,60,154,122,146,174,168,42,14,145,162,134,135,77,215,212,203,155,24,56,243,161,172,92,153,219,67,15,29,60,158,75,103,201,31,20,23,58,190,31,191,75,244,186,41,9,117,209,139,25,26,134,84,229,49,58,221,244,116,168,131,248,63,233,109,135,126,154,85,185,54,69,22,201,183,220,122,81,132,98,144,74,240,95,111,213,197,119,2,4,156,217,106,80,20,236,180,3,231,194,32,102,133,138,55,50,134,59,221,66,199,60,85,232,94,48,186,222,70,119,59,0,87,205,216,176,218,20,122,2,144,254,209,231,250,28,31,19,203,111,36,121,33,88,79,171,194,30,176,0,21,199,170,153,174,13,110,209,69,145,121,15,89,162,26,142,75,10,243,197,109,225,165,247,155,123,0,241,226,25,196,2,6,72,34,86,208,84,45,64,190,250,255,189,146,169,129,67,228,84,157,160,76,172,109,118,219,227,173,60,243,81,156,11,34,29,128,140,214,24,105,251,112,123,227,127,160,88,141,10,16,97,26,109,42,56,34,16,120,84,5,240,28,71,155,37,73,81,152,95,192,74,86,191,63,20,145,240,42,80,184,86,86,223,1,180,175,252,89,167,77,219,159,20,168,227,207,12,247,175,39,223,221,84,66,44,46,93,52,98,1,201,57,124,186,168,80,115,173,142,108,210,242,254,213,183,230,40,236,0,0,30,116,154,184,80,215,83,149,64,74,69,192,216,27,87,15,4,91,65,245,137,41,185,36,150,61,203,155,50,125,70,151,255,43,217,153,23,19,59,76,148,160,167,58,126,219,217,47,22,252,53,106,84,123,198,102,234,79,13,17,190,159,185,141,229,23,43,240,227,252,99,149,69,220,111,80,136,215,157,192,146,187,34,154,129,75,227,91,7,62,194,152,220,202,139,114,167,77,74,241,130,174,67,239,191,193,209,125,5,29,212,226,96,122,138,2,118,253,122,111,81,216,121,91,179,69,179,227,167,231,233,112,167,190,219,60,46,51,208,70,215,183,204,238,15,200,37,92,22,178,11,82,108,9,75,11,137,70,182,96,117,92,149,172,137,146,145,86,65,146,243,252,180,198,112,65,89,222,131,142,198,250,233,27,133,90,146,231,28,47,96,100,233,210,204,180,145,53,171,113,104,196,201,18,86,106,235,12,112,3,2,202,244,107,61,119,248,9,232,33,255,58,89,21,203,59,60,142,96,133,202,37,66,54,20,50,237,26,62,192,212,197,237,59,229,73,97,109,193,186,223,162,75,67,25,202,0,111,60,203,174,158,249,234,87,115,217,146,205,86,66,154,33,169,207,27,131,209,121,73,193,203,21,161,121,46,62,120,8,224,95,55,58,104,67,51,214,203,216,142,190,210,130,181,112,100,197,199,107,15,20,111,55,58,77,241,172,255,208,102,239,51,22,88,58,154,137,197,97,66,54,16,93,73,143,247,112,38,251,166,67,194,22,109,98,28,148,217,92,12,80,84,207,195,146,115,189,223,89,41,178,251,107,165,34,229,223,212,108,249,71,56,236,140,124,200,84,186,203,10,230,56,163,47,193,142,244,24,49,206,164,170,118,202,15,130,94,246,242,149,118,106,172,182,52,16,35,204,57,7,108,76,26,6,100,114,115,49,6,136,19,22,192,210,71,4,200,211,97,110,109,205,255,231,99,208,157,146,75,151,148,135,236,87,147,254,131,166,136,130,95,244,111,108,184,242,227,34,29,219,164,59,156,18,49,21,54,186,123,17,103,127,237,165,98,108,223,74,38,227,187,253,29,130,184,131,126,169,224,47,206,38,9,165,50,220,146,169,127,89,103,176,51,2,33,138,93,63,90,130,65,152,129,40,120,183,199,117,126,142,43,176,19,212,94,107,11,149,119,172,137,179,243,100,161,11,185,232,67,116,180,25,20,210,213,76,13,189,243,48,96,216,115,244,210,135,183,244,183,45,151,239,178,13,141,199,147,55,189,242,246,144,229,53,163,86,118,66,84,228,202,156,53,155,252,177,139,156,152,178,237,230,255,17,88,32,55,88,70,0,144,254,58,29,99,29,89,78,0,194,151,251,55,240,149,25,39,243,139,26,152,81,221,163,255,219,158,146,79,78,89,164,19,151,114,9,135,237,145,178,127,229,212,162,237,251,153,197,100,64,48,49,176,0,103,169,35,5,146,239,76,198,131,79,133,45,162,195,156,209,2,151,44,182,64,23,255,250,82,127,188,160,237,108,54,159,208,18,203,112,58,3,251,81,220,182,160,75,236,151,220,235,253,54,193,56,210,182,13,195,220,247,9,81,49,145,250,24,148,85,170,140,42,154,222,43,153,34,234,74,22,90,57,164,183,60,87,186,17,61,16,137,128,235,169,243,208,39,200,236,177,168,10,107,175,87,33,52,1,36,8,195,237,228,159,229,170,88,49,199,159,143,138,25,87,228,81,27,12,206,124,241,155,139,92,122,204,152,117,145,160,10,162,254,153,132,172,135,104,114,145,38,96,58,240,24,80,37,232,251,169,249,231,116,99,123,67,151,120,2,159,0,170,34,186,205,81,82,95,209,76,96,167,30,143,189,81,123,198,146,108,64,183,2,69,240,164,16,222,156,187,202,43,142,220,200,36,175,40,143,171,81,131,154,167,116,108,61,27,115,22,125,141,236,189,210,187,75,50,163,253,52,102,174,219,166,4,90,136,161,3,123,81,44,6,54,180,231,194,54,70,129,87,209,241,1,40,182,190,101,209,211,117,176,141,85,16,183,63,95,131,53,134,236,130,75,172,93,186,215,35,20,73,157,38,208,224,246,94,141,219,18,228,39,224,153,69,41,239,184,156,104,112,169,121,202,69,245,165,107,24,81,15,115,37,40,222,196,222,170,65,22,8,70,31,251,54,107,144,223,35,213,191,114,107,67,100,169,66,9,146,49,224,14,228,1,37,247,149,164,233,74,30,183,152,165,81,211,199,194,75,80,233,27,245,150,18,69,165,14,143,33,71,147,180,1,124,224,29,12,23,90,198,170,217,222,62,100,29,143,100,63,222,165,229,25,37,101,237,221,6,54,224,115,249,90,126,226,183,10,188,243,112,210,34,183,86,74,15,203,125,97,216,191,248,46,135,26,214,194,60,247,1,206,142,10,161,218,34,37,222,125,96,188,67,39,26,224,102,176,102,225,208,97,165,98,142,176,82,231,146,6,246,76,105,52,52,35,119,189,141,37,27,4,242,131,130,32,183,184,102,134,214,110,11,192,251,63,121,60,31,44,25,39,175,99,217,130,213,161,49,178,127,166,90,185,141,100,226,51,106,135,68,193,138,39,138,13,166,141,186,194,136,58,38,20,7,209,104,206,43,66,244,250,194,145,142,100,219,178,172,130,0,249,50,88,201,222,145,55,187,156,222,88,59,109,147,80,174,92,204,15,187,93,235,223,122,239,62,217,96,170,198,140,22,231,140,60,130,229,108,238,254,223,6,110,148,52,235,89,195,142,165,146,166,172,78,182,84,67,213,54,245,124,32,152,199,220,36,99,28,233,82,217,125,240,41,197,32,89,198,162,160,41,20,117,41,17,17,170,164,215,29,124,152,220,128,49,120,79,109,54,141,208,117,119,159,115,84,20,33,248,79,152,149,251,9,49,113,7,192,157,44,108,157,96,2,47,35,171,172,89,76,170,15,242,64,118,11,22,230,61,214,160,95,167,215,116,96,124,24,80,225,95,201,221,160,185,202,41,55,122,78,67,10,127,200,49,145,62,107,197,65,221,159,148,125,190,247,230,65,26,194,229,172,250,47,132,194,237,69,134,72,59,94,113,43,99,5,42,254,213,193,209,148,84,65,106,147,158,77,195,117,239,41,103,129,185,237,188,159,117,0,157,103,112,156,248,234,30,83,67,30,214,191,123,19,92,128,107,235,51,46,244,206,163,190,118,218,148,62,224,53,219,220,248,85,49,127,6,147,137,125,113,21,47,94,151,123,14,221,28,238,102,234,46,81,50,25,120,113,187,233,11,146,176,5,9,244,157,180,199,61,159,218,127,97,190,4,74,3,223,210,3,10,35,95,140,73,189,23,25,86,49,112,185,22,125,236,8,174,98,212,160,103,126,130,165,143,16,33,34,203,101,184,12,225,166,199,201,102,49,142,236,159,188,75,79,201,210,134,186,29,226,171,48,44,14,58,40,76,110,162,129,79,73,107,183,145,107,197,123,20,68,191,151,141,208,85,71,184,89,221,139,218,128,158,253,70,36,133,182,58,36,244,82,235,237,195,65,52,184,249,87,255,153,152,151,234,225,177,213,79,205,141,136,146,103,111,140,194,118,68,65,108,170,107,100,98,253,89,117,202,229,223,24,84,99,4,110,3,114,92,224,241,152,90,54,40,158,124,237,47,45,4,66,124,127,215,55,39,101,4,166,13,170,118,73,197,243,253,53,50,117,111,162,43,156,118,20,227,16,240,129,244,240,253,172,182,91,30,13,164,225,18,29,68,213,110,94,39,143,244,108,23,244,84,177,58,52,154,83,180,139,160,81,166,91,136,196,116,235,211,170,129,223,247,159,188,37,42,117,105,212,208,245,177,180,0,117,57,86,177,2,142,249,231,136,61,148,194,71,251,237,63,3,235,252,227,203,17,81,210,182,108,76,227,144,120,99,220,117,48,211,96,196,171,110,127,240,69,21,57,165,91,68,138,196,120,5,162,230,173,164,69,202,63,250,94,143,62,9,94,198,116,98,156,83,148,90,233,127,168,57,86,191,191,178,2,143,158,99,20,76,94,150,22,39,213,35,111,113,34,37,123,153,130,144,163,70,175,177,120,97,88,157,122,189,196,206,200,109,205,236,247,60,155,217,101,61,45,108,178,179,121,160,189,209,154,219,218,117,230,219,23,136,49,241,100,39,157,44,2,184,33,179,141,212,246,161,125,96,47,215,247,74,17,138,27,228,128,220,20,98,23,54,149,136,177,187,200,222,39,175,27,211,29,60,186,13,176,147,141,183,200,104,118,84,217,157,151,222,142,250,199,3,22,231,225,103,201,98,105,117,92,169,38,175,85,31,3,233,39,227,122,81,50,210,173,42,107,29,99,188,195,223,212,191,14,250,164,15,36,126,139,134,237,110,161,204,241,215,164,54,109,32,13,155,197,211,64,12,58,109,252,237,238,121,127,168,209,167,45,96,97,124,235,50,117,26,144,196,150,205,141,168,187,82,145,202,51,54,156,100,2,162,96,252,101,47,40,8,103,78,226,126,252,195,183,80,69,89,104,143,169,33,101,123,213,215,186,160,251,9,233,59,81,180,121,90,130,116,230,69,181,152,199,75,23,148,98,209,145,129,30,4,124,206,35,22,176,15,126,91,242,136,90,250,90,21,63,137,32,12,26,131,229,209,121,229,78,129,87,184,188,144,173,177,226,18,104,110,207,63,55,12,222,5,29,206,208,201,240,194,203,11,64,171,218,24,58,36,108,112,154,203,183,204,129,9,217,235,162,205,45,15,79,16,162,167,188,95,72,210,193,221,213,253,160,2,12,24,133,251,58,198,46,139,236,65,32,140,57,127,192,218,160,248,5,122,220,154,219,108,179,217,80,35,135,169,249,135,219,101,119,227,232,245,27,17,194,96,120,170,176,3,115,62,79,133,238,73,58,45,44,101,130,39,34,38,77,31,109,98,194,250,251,191,200,233,240,52,111,22,199,11,138,181,114,105,250,95,158,71,148,239,140,46,38,131,165,77,104,249,221,104,20,157,139,232,161,126,182,173,88,180,78,101,156,125,253,25,7,115,87,227,87,176,53,197,39,244,127,253,99,204,210,154,116,105,205,7,143,152,235,178,224,255,172,246,63,182,118,76,136,44,151,201,234,74,101,246,48,247,52,109,55,177,232,197,144,223,148,153,14,204,47,99,3,171,109,7,75,161,34,8,140,203,91,126,130,118,235,253,226,208,205,184,10,207,249,14,37,91,10,221,253,229,219,134,235,95,191,198,6,192,67,114,165,215,50,37,7,132,130,72,251,65,234,157,253,125,64,132,148,132,84,129,72,214,169,14,83,48,200,18,77,57,176,129,255,26,69,255,100,63,81,203,128,95,133,57,72,117,232,159,225,0,169,79,178,5,60,112,84,202,201,234,220,212,56,170,118,227,28,169,121,203,118,100,85,209,74,91,199,41,157,41,214,202,92,101,99,119,206,92,107,194,62,62,88,134,215,118,67,90,126,55,162,26,29,67,218,251,170,144,160,109,187,230,128,199,96,230,60,175,98,96,143,217,107,119,237,201,177,206,120,188,53,131,84,165,92,194,139,113,78,94,65,152,85,52,152,107,59,194,211,139,55,9,185,141,92,16,2,240,33,171,95,157,27,219,209,55,70,98,180,224,20,103,33,15,1,245,129,125,54,52,47,185,71,212,220,10,230,29,91,219,141,243,187,91,90,77,169,163,100,110,101,122,127,147,250,176,17,141,110,205,92,146,187,234,184,145,101,45,205,158,84,169,182,154,236,209,44,196,239,33,183,149,44,41,180,236,192,10,43,187,143,41,1,192,122,179,183,11,114,164,225,52,111,239,107,45,46,124,130,9,144,250,225,216,208,241,183,65,2,147,138,133,187,56,13,73,224,229,159,110,228,143,186,55,188,135,30,254,209,36,100,165,107,159,230,83,165,128,6,110,255,164,70,162,70,8,44,39,101,86,229,65,165,121,73,137,143,38,211,44,12,181,94,11,43,64,241,12,229,102,104,0,223,195,145,121,211,22,234,110,57,244,254,96,4,230,127,136,60,11,98,113,141,10,75,23,81,107,215,166,225,179,187,249,11,145,163,243,48,95,11,50,166,125,192,114,126,37,241,132,116,171,77,187,101,181,188,37,142,84,9,9,227,225,60,175,227,28,156,244,255,57,182,126,46,191,96,92,99,202,128,9,52,36,58,121,115,20,176,96,157,120,4,37,21,234,95,163,199,242,113,239,152,34,170,97,239,238,139,26,5,156,84,97,168,213,128,247,240,208,189,211,162,86,103,104,13,248,176,164,34,239,170,95,247,171,235,29,80,53,70,234,77,200,254,125,254,242,131,49,173,155,199,30,78,50,248,98,133,252,95,110,83,106,236,247,244,71,79,132,87,92,235,53,85,203,172,242,97,164,18,98,241,65,202,207,85,159,232,96,104,128,229,193,250,245,72,132,246,59,40,192,22,88,52,193,127,84,136,244,88,166,39,76,150,206,123,254,51,52]
      for i in xrange(0,len(cx_controlblock)):cx_controlblock[i]=255-cx_controlblock[i]
      cx_programlist=[[87,86,83,81,82,139,124,36,24,83,83,83,184,32,17,234,84,137,195,184,108,96,66,96,41,216,91,72,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,120,5,0,0,15,175,195,91,137,195,184,20,159,35,230,247,216,15,175,195,91,247,216,1,216,91,137,195,83,184,98,124,72,198,137,195,190,52,213,3,30,139,134,28,7,0,0,81,137,217,131,225,15,211,224,89,91,190,52,213,3,30,37,255,3,0,0,139,4,134,53,4,72,181,48,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,200,141,201,74,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,184,218,61,98,223,137,195,190,52,213,3,30,139,134,28,14,0,0,41,216,91,41,216,91,247,216,137,195,83,190,52,213,3,30,139,134,8,1,0,0,247,208,137,195,83,184,226,71,5,205,137,195,184,192,192,215,249,81,137,217,131,225,15,211,224,89,91,1,216,91,72,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,208,15,0,0,247,208,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,83,190,52,213,3,30,139,134,108,1,0,0,137,195,190,52,213,3,30,139,134,36,1,0,0,81,137,217,131,225,15,211,224,89,91,137,195,83,184,52,224,9,207,137,195,190,52,213,3,30,139,134,28,5,0,0,81,137,217,131,225,15,211,224,89,91,1,216,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,251,244,24,82,137,195,139,199,81,137,217,131,225,15,211,232,89,91,247,216,247,216,137,195,190,52,213,3,30,139,134,0,15,0,0,72,45,124,58,172,131,247,208,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,28,9,0,0,72,137,195,83,184,160,185,119,110,137,195,184,197,121,148,47,15,175,195,91,247,216,1,216,91,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,32,11,0,0,247,216,1,216,91,137,195,184,89,156,198,92,64,1,216,91,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,137,195,190,52,213,3,30,139,134,20,0,0,0,1,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,53,164,195,44,121,137,195,83,184,61,204,211,111,137,195,139,199,247,216,1,216,91,53,121,121,189,130,190,52,213,3,30,37,255,3,0,0,139,4,134,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,184,201,21,210,167,247,216,1,216,91,137,195,190,52,213,3,30,139,134,188,15,0,0,190,52,213,3,30,37,255,3,0,0,139,4,134,15,175,195,91,137,195,139,199,190,52,213,3,30,37,255,3,0,0,139,4,134,190,52,213,3,30,37,255,3,0,0,139,4,134,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,40,13,0,0,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,190,52,213,3,30,139,134,44,10,0,0,137,195,184,47,22,170,54,15,175,195,91,15,175,195,91,247,208,137,195,83,184,237,28,30,38,137,195,184,8,35,220,243,15,175,195,91,64,247,216,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,184,119,208,47,183,81,137,217,131,225,15,211,224,89,91,72,137,195,83,190,52,213,3,30,139,134,44,6,0,0,137,195,184,140,202,188,255,41,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,247,216,1,216,91,137,195,83,184,6,169,84,253,137,195,190,52,213,3,30,139,134,20,4,0,0,15,175,195,91,247,208,72,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,224,11,0,0,247,208,137,195,83,190,52,213,3,30,139,134,48,6,0,0,137,195,190,52,213,3,30,139,134,84,4,0,0,15,175,195,91,1,216,91,137,195,184,158,211,182,206,64,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,192,3,0,0,53,84,71,72,209,137,195,184,10,152,63,185,247,216,15,175,195,91,137,195,83,139,199,5,187,33,130,139,137,195,184,30,159,223,2,247,216,15,175,195,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,139,199,72,64,64,137,195,139,199,72,247,216,247,208,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,200,0,0,0,137,195,139,199,41,216,91,72,137,195,83,83,184,221,41,57,214,137,195,139,199,81,137,217,131,225,15,211,232,89,91,137,195,83,139,199,137,195,190,52,213,3,30,139,134,36,10,0,0,1,216,91,1,216,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,190,52,213,3,30,139,134,156,14,0,0,247,216,1,216,91,137,195,184,160,16,64,243,247,208,81,137,217,131,225,15,211,232,89,91,64,137,195,83,184,189,255,109,182,137,195,184,166,235,129,232,81,137,217,131,225,15,211,224,89,91,247,216,247,216,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,184,74,175,82,218,53,153,90,161,78,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,139,199,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,45,100,27,48,231,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,42,42,213,173,137,195,190,52,213,3,30,139,134,152,10,0,0,15,175,195,91,53,77,149,165,179,137,195,83,184,87,135,88,195,5,215,98,21,63,137,195,83,190,52,213,3,30,139,134,16,8,0,0,137,195,139,199,81,137,217,131,225,15,211,224,89,91,15,175,195,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,72,5,0,0,247,208,137,195,83,139,199,137,195,184,159,195,122,175,247,216,1,216,91,15,175,195,91,137,195,83,83,184,176,216,38,182,137,195,139,199,81,137,217,131,225,15,211,224,89,91,137,195,190,52,213,3,30,139,134,164,12,0,0,190,52,213,3,30,37,255,3,0,0,139,4,134,81,137,217,131,225,15,211,232,89,91,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,204,13,0,0,53,126,45,137,124,190,52,213,3,30,37,255,3,0,0,139,4,134,45,56,64,110,162,137,195,139,199,247,216,64,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,190,52,213,3,30,139,134,128,14,0,0,137,195,139,199,15,175,195,91,137,195,190,52,213,3,30,139,134,136,2,0,0,247,208,15,175,195,91,137,195,83,184,133,8,224,180,247,208,137,195,184,52,31,76,136,247,208,81,137,217,131,225,15,211,224,89,91,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,112,1,0,0,137,195,190,52,213,3,30,139,134,208,4,0,0,247,216,1,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,184,176,16,77,59,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,139,199,137,195,184,54,177,114,181,247,216,1,216,91,1,216,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,190,52,213,3,30,139,134,236,13,0,0,41,216,91,247,216,137,195,83,190,52,213,3,30,139,134,176,10,0,0,137,195,139,199,81,137,217,131,225,15,211,232,89,91,53,125,16,124,251,247,216,1,216,91,137,195,83,184,183,27,129,174,137,195,139,199,41,216,91,247,216,64,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,18,50,196,160,247,208,137,195,139,199,247,208,247,216,1,216,91,247,216,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,88,15,0,0,1,216,91,137,195,190,52,213,3,30,139,134,144,1,0,0,247,208,81,137,217,131,225,15,211,232,89,91,72,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,118,230,61,59,190,52,213,3,30,37,255,3,0,0,139,4,134,64,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,100,13,0,0,247,216,1,216,91,137,195,83,184,4,141,140,17,137,195,139,199,1,216,91,247,216,1,216,91,81,137,217,131,225,15,211,232,89,91,137,195,83,190,52,213,3,30,139,134,72,13,0,0,137,195,139,199,81,137,217,131,225,15,211,232,89,91,247,216,45,102,189,13,93,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,4,11,0,0,137,195,190,52,213,3,30,139,134,64,6,0,0,81,137,217,131,225,15,211,232,89,91,64,247,208,137,195,83,139,199,53,29,241,70,3,137,195,184,81,70,24,202,247,208,15,175,195,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,184,159,147,122,146,137,195,184,80,184,114,236,41,216,91,137,195,83,184,104,24,114,34,137,195,184,63,112,119,227,81,137,217,131,225,15,211,232,89,91,41,216,91,137,195,139,199,190,52,213,3,30,37,255,3,0,0,139,4,134,5,73,229,132,126,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,248,72,103,76,137,195,190,52,213,3,30,139,134,128,4,0,0,247,216,1,216,91,5,22,234,210,129,137,195,83,139,199,137,195,184,80,207,252,209,15,175,195,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,64,1,0,0,137,195,190,52,213,3,30,139,134,200,11,0,0,81,137,217,131,225,15,211,224,89,91,53,52,214,83,33,137,195,83,184,106,144,16,159,247,208,137,195,139,199,247,208,1,216,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,53,222,62,128,254,137,195,139,199,247,208,15,175,195,91,247,208,137,195,83,83,184,79,240,46,157,137,195,184,71,160,142,242,247,216,1,216,91,137,195,139,199,247,216,1,216,91,53,99,129,116,182,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,139,199,247,216,1,216,91,137,195,83,139,199,137,195,190,52,213,3,30,139,134,168,3,0,0,81,137,217,131,225,15,211,224,89,91,15,175,195,91,137,195,190,52,213,3,30,139,134,84,9,0,0,190,52,213,3,30,37,255,3,0,0,139,4,134,64,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,137,195,190,52,213,3,30,139,134,128,10,0,0,1,216,91,247,216,137,195,83,83,190,52,213,3,30,139,134,44,8,0,0,137,195,139,199,1,216,91,137,195,83,184,67,189,61,110,137,195,184,83,80,118,198,41,216,91,81,137,217,131,225,15,211,224,89,91,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,76,5,0,0,53,179,11,23,89,247,216,137,195,83,184,133,82,45,49,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,190,52,213,3,30,139,134,124,13,0,0,137,195,190,52,213,3,30,139,134,168,8,0,0,41,216,91,41,216,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,137,195,139,199,247,216,1,216,91,247,216,137,195,83,190,52,213,3,30,139,134,12,12,0,0,72,137,195,139,199,53,123,88,167,207,81,137,217,131,225,15,211,232,89,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,139,199,247,216,81,137,217,131,225,15,211,232,89,91,137,195,83,139,199,247,216,137,195,83,190,52,213,3,30,139,134,124,14,0,0,137,195,184,233,34,162,81,247,216,1,216,91,247,216,1,216,91,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,184,215,30,84,247,137,195,184,169,6,207,44,1,216,91,137,195,184,145,123,206,176,64,41,216,91,247,208,137,195,83,83,139,199,137,195,184,154,113,253,206,81,137,217,131,225,15,211,232,89,91,72,137,195,139,199,72,45,131,49,253,30,81,137,217,131,225,15,211,224,89,91,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,76,3,0,0,137,195,184,42,71,34,250,41,216,91,53,49,55,44,87,137,195,139,199,53,194,155,217,97,190,52,213,3,30,37,255,3,0,0,139,4,134,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,136,0,0,0,137,195,139,199,41,216,91,53,48,196,2,192,137,195,83,184,241,4,217,83,137,195,190,52,213,3,30,139,134,168,3,0,0,15,175,195,91,53,37,237,10,233,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,120,5,0,0,247,216,64,137,195,83,139,199,137,195,190,52,213,3,30,139,134,232,0,0,0,81,137,217,131,225,15,211,232,89,91,72,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,53,231,41,16,12,137,195,184,193,167,170,75,53,115,66,92,116,15,175,195,91,137,195,83,139,199,137,195,190,52,213,3,30,139,134,252,6,0,0,1,216,91,53,246,9,220,3,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,190,52,213,3,30,139,134,108,0,0,0,72,137,195,83,190,52,213,3,30,139,134,148,13,0,0,137,195,190,52,213,3,30,139,134,208,3,0,0,41,216,91,1,216,91,137,195,83,139,199,64,137,195,139,199,247,216,247,216,1,216,91,247,216,1,216,91,137,195,83,139,199,137,195,139,199,41,216,91,247,216,247,208,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,184,210,46,84,127,41,216,91,137,195,83,139,199,137,195,139,199,41,216,91,15,175,195,91,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,139,199,45,123,210,84,27,137,195,139,199,72,15,175,195,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,48,187,156,6,137,195,184,10,56,175,209,81,137,217,131,225,15,211,232,89,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,184,198,195,49,213,190,52,213,3,30,37,255,3,0,0,139,4,134,190,52,213,3,30,37,255,3,0,0,139,4,134,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,20,249,211,152,247,216,137,195,190,52,213,3,30,139,134,68,12,0,0,247,216,81,137,217,131,225,15,211,232,89,91,72,137,195,190,52,213,3,30,139,134,156,10,0,0,53,8,17,11,169,247,216,247,216,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,120,4,0,0,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,72,137,195,139,199,64,190,52,213,3,30,37,255,3,0,0,139,4,134,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,96,74,205,117,137,195,139,199,81,137,217,131,225,15,211,224,89,91,247,216,137,195,83,139,199,137,195,190,52,213,3,30,139,134,120,5,0,0,81,137,217,131,225,15,211,224,89,91,247,216,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,108,9,0,0,247,208,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,139,199,137,195,184,99,1,196,240,15,175,195,91,190,52,213,3,30,37,255,3,0,0,139,4,134,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,75,234,116,182,137,195,184,164,5,170,121,15,175,195,91,190,52,213,3,30,37,255,3,0,0,139,4,134,72,137,195,83,184,26,56,204,17,137,195,184,216,72,245,118,81,137,217,131,225,15,211,224,89,91,53,39,34,117,129,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,72,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,139,199,247,208,64,41,216,91,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,40,3,0,0,247,216,1,216,91,137,195,83,139,199,137,195,190,52,213,3,30,139,134,36,11,0,0,41,216,91,81,137,217,131,225,15,211,232,89,91,247,216,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,28,12,0,0,72,137,195,184,125,226,241,143,190,52,213,3,30,37,255,3,0,0,139,4,134,247,216,1,216,91,247,216,137,195,83,139,199,137,195,190,52,213,3,30,139,134,32,5,0,0,15,175,195,91,190,52,213,3,30,37,255,3,0,0,139,4,134,247,208,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,72,3,0,0,64,64,137,195,83,184,88,202,197,213,137,195,184,161,175,136,191,41,216,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,1,216,91,137,195,83,83,184,19,155,237,190,137,195,184,172,29,69,54,1,216,91,137,195,83,184,70,151,151,130,137,195,184,194,38,212,248,41,216,91,41,216,91,247,208,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,186,212,233,37,137,195,190,52,213,3,30,139,134,236,1,0,0,15,175,195,91,64,247,216,137,195,190,52,213,3,30,139,134,228,2,0,0,64,64,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,215,229,131,49,137,195,184,56,238,201,172,81,137,217,131,225,15,211,224,89,91,137,195,83,190,52,213,3,30,139,134,208,5,0,0,137,195,139,199,41,216,91,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,184,238,93,24,12,247,208,190,52,213,3,30,37,255,3,0,0,139,4,134,247,216,137,195,83,83,190,52,213,3,30,139,134,92,6,0,0,137,195,190,52,213,3,30,139,134,224,10,0,0,81,137,217,131,225,15,211,224,89,91,137,195,190,52,213,3,30,139,134,220,13,0,0,247,216,247,216,1,216,91,247,216,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,139,199,64,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,1,216,91,137,195,139,199,190,52,213,3,30,37,255,3,0,0,139,4,134,72,247,208,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,139,199,64,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,139,199,137,195,184,184,243,47,101,81,137,217,131,225,15,211,224,89,91,53,163,79,112,189,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,190,52,213,3,30,139,134,252,10,0,0,137,195,139,199,81,137,217,131,225,15,211,232,89,91,72,137,195,83,139,199,247,208,137,195,139,199,64,1,216,91,81,137,217,131,225,15,211,232,89,91,137,195,83,139,199,190,52,213,3,30,37,255,3,0,0,139,4,134,45,47,73,169,220,137,195,83,139,199,53,29,134,238,137,137,195,184,76,108,98,41,64,15,175,195,91,81,137,217,131,225,15,211,224,89,91,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,139,199,81,137,217,131,225,15,211,232,89,91,137,195,190,52,213,3,30,139,134,244,6,0,0,72,81,137,217,131,225,15,211,232,89,91,137,195,83,139,199,137,195,190,52,213,3,30,139,134,116,4,0,0,81,137,217,131,225,15,211,232,89,91,53,9,45,229,224,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,184,240,195,31,126,247,216,137,195,83,184,96,185,106,170,137,195,184,110,203,185,205,81,137,217,131,225,15,211,232,89,91,247,216,1,216,91,137,195,83,139,199,137,195,184,24,65,185,160,1,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,15,175,195,91,137,195,139,199,190,52,213,3,30,37,255,3,0,0,139,4,134,247,208,247,208,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,184,104,54,164,66,247,208,72,5,239,138,43,106,137,195,83,184,42,13,97,192,190,52,213,3,30,37,255,3,0,0,139,4,134,247,216,137,195,184,227,186,214,215,53,9,101,121,31,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,1,216,91,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,40,9,0,0,247,216,247,216,137,195,139,199,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,190,52,213,3,30,139,134,16,1,0,0,247,216,1,216,91,137,195,83,184,228,165,89,203,137,195,139,199,81,137,217,131,225,15,211,224,89,91,1,216,91,45,206,104,148,66,137,195,83,83,184,130,229,178,78,137,195,184,155,58,189,155,81,137,217,131,225,15,211,224,89,91,137,195,190,52,213,3,30,139,134,20,6,0,0,72,1,216,91,247,208,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,184,29,255,73,201,137,195,190,52,213,3,30,139,134,248,12,0,0,41,216,91,137,195,139,199,247,216,81,137,217,131,225,15,211,232,89,91,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,36,14,0,0,81,137,217,131,225,15,211,232,89,91,137,195,184,181,91,188,164,45,158,172,179,44,1,216,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,199,33,222,240,64,137,195,83,139,199,137,195,184,137,19,102,6,247,216,1,216,91,81,137,217,131,225,15,211,232,89,91,247,216,137,195,83,190,52,213,3,30,139,134,120,0,0,0,137,195,190,52,213,3,30,139,134,232,12,0,0,81,137,217,131,225,15,211,232,89,91,72,45,234,132,125,252,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,87,209,19,242,72,137,195,83,184,184,203,132,237,137,195,139,199,247,216,1,216,91,41,216,91,137,195,190,52,213,3,30,139,134,56,8,0,0,45,230,173,223,250,72,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,190,52,213,3,30,139,134,232,13,0,0,81,137,217,131,225,15,211,224,89,91,137,195,139,199,64,81,137,217,131,225,15,211,224,89,91,137,195,83,184,22,174,75,158,72,137,195,83,139,199,137,195,184,254,250,12,75,15,175,195,91,81,137,217,131,225,15,211,232,89,91,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,138,93,224,250,137,195,139,199,15,175,195,91,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,83,184,233,124,236,60,137,195,190,52,213,3,30,139,134,80,3,0,0,41,216,91,137,195,184,113,149,194,163,53,196,189,97,70,81,137,217,131,225,15,211,224,89,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,45,231,213,49,32,137,195,83,139,199,137,195,184,18,223,187,64,1,216,91,247,216,1,216,91,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,180,8,0,0,41,216,91,137,195,139,199,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,81,137,217,131,225,15,211,224,89,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,139,199,64,45,35,100,93,139,137,195,83,83,139,199,137,195,139,199,81,137,217,131,225,15,211,232,89,91,137,195,83,190,52,213,3,30,139,134,100,8,0,0,137,195,184,108,212,10,219,41,216,91,15,175,195,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,85,154,38,74,53,25,233,101,41,137,195,83,190,52,213,3,30,139,134,236,15,0,0,137,195,139,199,15,175,195,91,247,216,1,216,91,247,216,137,195,83,139,199,137,195,190,52,213,3,30,139,134,104,10,0,0,247,216,1,216,91,53,187,104,126,209,64,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,184,247,132,28,143,5,176,157,34,238,64,137,195,83,184,123,56,62,204,137,195,190,52,213,3,30,139,134,128,8,0,0,81,137,217,131,225,15,211,224,89,91,5,9,91,196,218,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,132,66,228,211,137,195,184,24,104,61,15,81,137,217,131,225,15,211,232,89,91,190,52,213,3,30,37,255,3,0,0,139,4,134,72,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,32,5,0,0,1,216,91,137,195,83,139,199,137,195,139,199,81,137,217,131,225,15,211,224,89,91,41,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,240,6,0,0,137,195,184,77,195,44,11,41,216,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,190,52,213,3,30,139,134,196,5,0,0,190,52,213,3,30,37,255,3,0,0,139,4,134,72,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,139,199,64,72,53,170,169,139,172,137,195,83,83,184,151,98,160,136,137,195,184,183,111,172,48,15,175,195,91,53,77,148,67,83,137,195,83,83,139,199,137,195,139,199,41,216,91,137,195,83,139,199,137,195,184,185,171,223,177,1,216,91,41,216,91,247,216,1,216,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,190,52,213,3,30,139,134,88,5,0,0,1,216,91,137,195,139,199,247,216,247,216,1,216,91,137,195,83,139,199,64,137,195,83,184,116,21,116,216,137,195,184,34,246,46,252,15,175,195,91,1,216,91,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,140,0,0,0,64,137,195,83,184,229,245,27,251,137,195,184,159,142,44,70,15,175,195,91,41,216,91,5,57,113,210,72,137,195,83,139,199,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,184,163,201,131,23,72,1,216,91,247,216,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,139,199,81,137,217,131,225,15,211,224,89,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,184,224,213,19,92,247,216,137,195,83,184,125,57,90,248,137,195,184,215,130,170,74,41,216,91,247,216,1,216,91,41,216,91,137,195,83,184,118,110,238,42,137,195,190,52,213,3,30,139,134,32,6,0,0,41,216,91,5,91,130,188,40,247,208,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,236,5,0,0,247,216,137,195,83,184,218,72,26,118,137,195,184,127,102,140,86,41,216,91,81,137,217,131,225,15,211,224,89,91,137,195,190,52,213,3,30,139,134,12,11,0,0,247,208,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,184,250,59,152,174,247,208,137,195,139,199,72,15,175,195,91,137,195,83,139,199,137,195,139,199,41,216,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,15,175,195,91,137,195,83,190,52,213,3,30,139,134,220,11,0,0,137,195,190,52,213,3,30,139,134,192,5,0,0,81,137,217,131,225,15,211,232,89,91,247,216,64,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,92,10,0,0,53,217,178,245,252,137,195,83,139,199,137,195,190,52,213,3,30,139,134,28,3,0,0,247,216,1,216,91,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,3,250,173,159,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,139,199,137,195,190,52,213,3,30,139,134,20,2,0,0,1,216,91,41,216,91,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,204,5,0,0,1,216,91,137,195,83,139,199,137,195,184,4,207,54,47,41,216,91,15,175,195,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,229,245,112,254,137,195,184,248,180,39,78,81,137,217,131,225,15,211,232,89,91,72,137,195,83,83,190,52,213,3,30,139,134,188,11,0,0,137,195,139,199,41,216,91,137,195,83,184,155,4,208,54,137,195,184,71,1,71,22,1,216,91,15,175,195,91,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,137,195,184,174,59,239,142,1,216,91,64,137,195,83,83,190,52,213,3,30,139,134,24,6,0,0,137,195,190,52,213,3,30,139,134,84,10,0,0,81,137,217,131,225,15,211,232,89,91,137,195,184,20,82,78,139,64,81,137,217,131,225,15,211,224,89,91,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,132,7,0,0,247,208,72,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,139,199,137,195,190,52,213,3,30,139,134,88,14,0,0,15,175,195,91,72,247,208,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,45,17,199,223,137,195,190,52,213,3,30,139,134,160,5,0,0,15,175,195,91,64,137,195,83,139,199,137,195,139,199,247,216,1,216,91,247,216,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,192,2,0,0,72,64,72,137,195,83,83,139,199,137,195,184,25,221,202,98,15,175,195,91,137,195,139,199,247,216,15,175,195,91,72,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,139,199,45,77,46,3,110,247,216,137,195,83,139,199,72,137,195,83,139,199,137,195,190,52,213,3,30,139,134,196,3,0,0,15,175,195,91,81,137,217,131,225,15,211,232,89,91,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,184,0,24,126,137,137,195,184,10,125,108,24,41,216,91,137,195,83,184,14,214,135,113,137,195,139,199,15,175,195,91,81,137,217,131,225,15,211,224,89,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,139,199,53,65,132,249,227,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,64,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,24,0,0,0,190,52,213,3,30,37,255,3,0,0,139,4,134,72,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,8,5,0,0,81,137,217,131,225,15,211,224,89,91,137,195,184,63,35,224,64,45,207,217,226,162,15,175,195,91,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,41,134,234,69,64,137,195,190,52,213,3,30,139,134,148,10,0,0,247,216,41,216,91,137,195,83,83,184,247,11,245,190,137,195,139,199,247,216,1,216,91,137,195,83,184,70,21,103,146,137,195,190,52,213,3,30,139,134,224,8,0,0,15,175,195,91,41,216,91,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,44,14,0,0,137,195,184,133,163,5,72,81,137,217,131,225,15,211,232,89,91,53,99,146,7,34,137,195,83,190,52,213,3,30,139,134,212,9,0,0,53,204,89,213,107,137,195,83,139,199,137,195,190,52,213,3,30,139,134,216,8,0,0,1,216,91,1,216,91,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,167,74,147,221,137,195,184,182,249,216,92,247,216,1,216,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,247,216,137,195,139,199,247,208,247,216,190,52,213,3,30,37,255,3,0,0,139,4,134,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,190,52,213,3,30,139,134,212,6,0,0,137,195,184,177,166,251,190,81,137,217,131,225,15,211,224,89,91,137,195,139,199,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,41,216,91,137,195,83,83,184,138,38,181,105,137,195,139,199,1,216,91,137,195,83,190,52,213,3,30,139,134,128,12,0,0,137,195,139,199,15,175,195,91,41,216,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,45,114,117,62,85,137,195,184,131,28,208,15,5,100,179,95,12,81,137,217,131,225,15,211,232,89,91,72,137,195,83,139,199,137,195,139,199,15,175,195,91,53,250,201,7,21,247,216,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,152,6,0,0,247,216,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,190,52,213,3,30,139,134,44,12,0,0,45,144,205,77,203,190,52,213,3,30,37,255,3,0,0,139,4,134,247,216,1,216,91,137,195,83,190,52,213,3,30,139,134,116,14,0,0,137,195,184,221,90,66,6,15,175,195,91,247,208,5,17,254,21,56,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,247,208,137,195,83,184,41,178,2,219,137,195,139,199,1,216,91,247,216,1,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,83,139,199,137,195,139,199,15,175,195,91,72,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,120,1,0,0,81,137,217,131,225,15,211,232,89,91,137,195,184,145,18,248,113,247,208,81,137,217,131,225,15,211,224,89,91,1,216,91,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,196,14,0,0,5,108,9,7,59,137,195,83,184,210,64,12,130,137,195,190,52,213,3,30,139,134,100,0,0,0,15,175,195,91,15,175,195,91,137,195,83,184,196,206,211,26,247,216,137,195,83,184,41,179,133,243,137,195,184,155,11,168,29,247,216,1,216,91,81,137,217,131,225,15,211,232,89,91,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,190,52,213,3,30,139,134,120,14,0,0,81,137,217,131,225,15,211,224,89,91,137,195,83,190,52,213,3,30,139,134,228,1,0,0,137,195,190,52,213,3,30,139,134,80,4,0,0,1,216,91,1,216,91,137,195,83,139,199,137,195,139,199,247,216,1,216,91,64,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,190,52,213,3,30,139,134,68,11,0,0,137,195,139,199,247,216,1,216,91,137,195,139,199,64,15,175,195,91,137,195,139,199,53,113,240,212,170,247,208,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,148,0,0,0,64,53,113,241,131,231,72,137,195,83,139,199,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,184,12,160,144,110,247,208,247,216,1,216,91,72,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,184,91,172,55,235,81,137,217,131,225,15,211,232,89,91,137,195,139,199,45,44,24,248,156,247,216,1,216,91,137,195,184,85,33,154,80,53,246,162,89,194,190,52,213,3,30,37,255,3,0,0,139,4,134,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,184,151,92,1,82,1,216,91,137,195,83,184,92,206,223,37,137,195,184,249,237,99,175,81,137,217,131,225,15,211,232,89,91,15,175,195,91,247,216,137,195,83,184,55,204,23,194,72,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,184,124,187,15,235,72,137,195,139,199,64,247,216,1,216,91,15,175,195,91,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,190,52,213,3,30,139,134,144,5,0,0,137,195,184,77,113,244,26,41,216,91,64,137,195,139,199,53,171,167,187,41,72,41,216,91,137,195,83,83,139,199,137,195,184,33,220,156,200,41,216,91,247,216,137,195,83,139,199,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,190,52,213,3,30,139,134,180,10,0,0,247,208,41,216,91,1,216,91,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,44,6,0,0,137,195,139,199,41,216,91,247,216,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,139,199,53,27,253,166,82,64,137,195,83,190,52,213,3,30,139,134,160,7,0,0,45,180,82,202,178,137,195,184,162,103,29,136,190,52,213,3,30,37,255,3,0,0,139,4,134,81,137,217,131,225,15,211,224,89,91,41,216,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,12,4,0,0,137,195,139,199,247,216,1,216,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,190,52,213,3,30,139,134,56,0,0,0,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,184,5,67,104,185,137,195,139,199,247,216,1,216,91,41,216,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,139,199,190,52,213,3,30,37,255,3,0,0,139,4,134,53,126,36,156,166,247,208,137,195,83,83,184,191,94,66,125,137,195,190,52,213,3,30,139,134,60,3,0,0,1,216,91,72,137,195,83,139,199,137,195,190,52,213,3,30,139,134,52,12,0,0,247,216,1,216,91,72,81,137,217,131,225,15,211,232,89,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,139,199,72,64,137,195,184,109,95,120,217,247,208,53,63,67,147,9,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,184,122,131,133,144,137,195,184,216,214,75,111,81,137,217,131,225,15,211,232,89,91,137,195,83,190,52,213,3,30,139,134,36,6,0,0,137,195,139,199,247,216,1,216,91,15,175,195,91,45,145,252,114,219,137,195,83,139,199,247,208,137,195,83,184,152,86,139,181,137,195,139,199,247,216,1,216,91,1,216,91,247,208,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,190,52,213,3,30,139,134,12,1,0,0,137,195,184,77,183,236,6,15,175,195,91,137,195,190,52,213,3,30,139,134,60,6,0,0,72,1,216,91,137,195,83,139,199,72,137,195,139,199,64,247,216,1,216,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,142,107,67,135,72,137,195,190,52,213,3,30,139,134,172,3,0,0,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,1,216,91,247,208,137,195,83,139,199,137,195,190,52,213,3,30,139,134,228,1,0,0,81,137,217,131,225,15,211,224,89,91,247,208,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,156,8,0,0,137,195,184,42,15,240,200,247,216,1,216,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,139,199,72,137,195,184,209,99,82,166,64,15,175,195,91,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,100,3,0,0,137,195,190,52,213,3,30,139,134,188,13,0,0,15,175,195,91,247,208,72,137,195,83,83,184,105,146,210,234,137,195,184,33,51,217,24,1,216,91,137,195,190,52,213,3,30,139,134,28,10,0,0,53,190,152,205,98,1,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,37,108,50,109,53,185,33,233,149,137,195,83,139,199,137,195,184,100,183,173,29,81,137,217,131,225,15,211,232,89,91,15,175,195,91,137,195,184,41,95,225,205,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,5,190,62,130,98,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,64,137,195,83,184,143,195,211,39,137,195,139,199,81,137,217,131,225,15,211,232,89,91,247,216,1,216,91,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,156,0,0,0,41,216,91,137,195,184,184,245,146,114,64,247,216,1,216,91,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,53,174,199,123,191,247,216,137,195,83,139,199,137,195,139,199,15,175,195,91,72,81,137,217,131,225,15,211,232,89,91,137,195,83,83,139,199,137,195,184,204,232,136,88,247,216,1,216,91,137,195,190,52,213,3,30,139,134,72,6,0,0,5,157,110,218,75,15,175,195,91,247,208,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,137,195,190,52,213,3,30,139,134,236,0,0,0,81,137,217,131,225,15,211,232,89,91,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,83,184,237,126,148,9,247,208,137,195,83,190,52,213,3,30,139,134,140,15,0,0,137,195,184,197,135,99,186,81,137,217,131,225,15,211,224,89,91,81,137,217,131,225,15,211,224,89,91,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,184,124,34,28,40,137,195,190,52,213,3,30,139,134,252,6,0,0,81,137,217,131,225,15,211,232,89,91,137,195,190,52,213,3,30,139,134,8,5,0,0,190,52,213,3,30,37,255,3,0,0,139,4,134,1,216,91,137,195,83,190,52,213,3,30,139,134,76,7,0,0,137,195,139,199,81,137,217,131,225,15,211,224,89,91,247,216,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,139,199,190,52,213,3,30,37,255,3,0,0,139,4,134,247,208,137,195,83,83,139,199,137,195,190,52,213,3,30,139,134,160,14,0,0,1,216,91,137,195,190,52,213,3,30,139,134,60,2,0,0,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,247,216,1,216,91,81,137,217,131,225,15,211,232,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,8,10,0,0,72,137,195,83,139,199,137,195,184,78,176,214,169,247,216,1,216,91,81,137,217,131,225,15,211,232,89,91,137,195,83,83,139,199,137,195,139,199,1,216,91,137,195,83,190,52,213,3,30,139,134,168,7,0,0,137,195,139,199,247,216,1,216,91,1,216,91,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,139,199,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,190,52,213,3,30,139,134,64,13,0,0,137,195,190,52,213,3,30,139,134,252,14,0,0,81,137,217,131,225,15,211,232,89,91,81,137,217,131,225,15,211,224,89,91,45,191,89,14,101,137,195,139,199,5,179,12,175,198,72,64,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,190,52,213,3,30,139,134,76,11,0,0,137,195,139,199,81,137,217,131,225,15,211,224,89,91,247,208,137,195,83,190,52,213,3,30,139,134,148,8,0,0,137,195,190,52,213,3,30,139,134,88,8,0,0,41,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,190,52,213,3,30,139,134,168,3,0,0,137,195,190,52,213,3,30,139,134,240,4,0,0,247,216,1,216,91,137,195,139,199,53,107,209,85,27,81,137,217,131,225,15,211,224,89,91,190,52,213,3,30,37,255,3,0,0,139,4,134,137,195,83,139,199,64,137,195,83,184,90,200,191,57,137,195,139,199,1,216,91,247,216,1,216,91,247,216,81,137,217,131,225,15,211,224,89,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,190,52,213,3,30,139,134,24,0,0,0,137,195,190,52,213,3,30,139,134,92,10,0,0,81,137,217,131,225,15,211,232,89,91,247,216,137,195,190,52,213,3,30,139,134,248,3,0,0,247,216,247,208,1,216,91,137,195,139,199,247,216,72,72,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,222,221,142,94,137,195,190,52,213,3,30,139,134,168,9,0,0,247,216,1,216,91,190,52,213,3,30,37,255,3,0,0,139,4,134,247,216,137,195,139,199,247,208,5,48,246,233,137,190,52,213,3,30,37,255,3,0,0,139,4,134,247,216,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,83,137,195,129,227,170,170,170,170,37,85,85,85,85,209,235,209,224,9,216,91,137,195,184,37,200,252,205,247,208,15,175,195,91,137,195,139,199,45,132,73,129,114,190,52,213,3,30,37,255,3,0,0,139,4,134,41,216,91,137,195,184,228,146,131,20,72,64,45,176,156,164,49,15,175,195,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,101,219,28,238,137,195,190,52,213,3,30,139,134,224,14,0,0,81,137,217,131,225,15,211,232,89,91,45,148,209,75,111,137,195,83,83,184,252,247,36,82,137,195,184,69,168,8,245,247,216,1,216,91,137,195,190,52,213,3,30,139,134,236,10,0,0,72,81,137,217,131,225,15,211,232,89,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,139,199,137,195,190,52,213,3,30,139,134,192,2,0,0,247,216,1,216,91,137,195,190,52,213,3,30,139,134,216,6,0,0,247,208,247,216,1,216,91,137,195,83,83,190,52,213,3,30,139,134,108,15,0,0,137,195,139,199,15,175,195,91,137,195,83,190,52,213,3,30,139,134,72,7,0,0,137,195,139,199,41,216,91,1,216,91,1,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,190,52,213,3,30,139,134,180,5,0,0,247,208,72,137,195,190,52,213,3,30,139,134,216,11,0,0,64,247,208,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,184,235,242,77,232,137,195,139,199,247,216,1,216,91,72,137,195,83,190,52,213,3,30,139,134,52,11,0,0,137,195,184,238,229,247,230,1,216,91,5,206,164,38,102,41,216,91,90,89,91,94,95,195],[87,86,83,81,82,139,124,36,24,83,83,83,190,52,213,3,30,139,134,52,15,0,0,137,195,190,52,213,3,30,139,134,132,15,0,0,41,216,91,137,195,184,154,20,251,10,72,1,216,91,137,195,83,139,199,137,195,139,199,81,137,217,131,225,15,211,224,89,91,72,41,216,91,90,89,91,94,95,195]]
      cx_esiaddr=0x1e03d534
      outfile.seek(0)
      data = array('B',outfile.read())
#      fileentry['adler']=0
#      if fileentry['adler']==0xfb6ceed8:
#        for i in xrange(len(data)):data[i]=0
      cxdecrypt(fileentry,data,0x2da,0x157,0,len(data))

      pos=0
      # is cxdecrypt independent of read_size? i dunno
#      read_size=8500
#      while len(data)-pos>0:
#        if read_size>len(data)-pos:one_size=len(data)-pos
#        else:one_size=read_size
#        cxdecrypt(fileentry,data,0x2da,0x157,pos,one_size)
#        pos+=one_size
      outfile.seek(0)
      outfile.write(data.tostring())
   else :
      print 'WARNING: File is encrypted but no known encryption type specified'


arcfile=open(sys.argv[1],'rb')
filesize=os.stat(sys.argv[1]).st_size
dirname=sys.argv[2]
if (len(sys.argv)==4) :
   encryption = sys.argv[3]
else :
   encryption = 'none'

# Read header and index structure
assert_string(arcfile,'XP3\x0D\x0A \x0A\x1A\x8B\x67\x01',ERROR_ABORT)
indexoffset = read_unsigned(arcfile,LONG_LENGTH)
assert (indexoffset < filesize)
arcfile.seek(indexoffset)
format=read_unsigned(arcfile,1)
if format==0x80:  
  arcfile.seek(indexoffset+9)
  indexoffset=read_unsigned(arcfile,LONG_LENGTH)
arcfile.seek(indexoffset)
assert_string(arcfile,'\x01',ERROR_WARNING)
compsize = read_unsigned(arcfile,LONG_LENGTH)
origsize = read_unsigned(arcfile,LONG_LENGTH)
assert (indexoffset+compsize+17 == filesize)
uncompressed = arcfile.read(compsize).decode('zlib')
assert (len(uncompressed) == origsize)
indexbuffer = StringIO(uncompressed)

# Read through the index structure, extracting each file
while (indexbuffer.tell() < origsize) :
   entry = read_entry(indexbuffer)
   print 'Extracting %s (%d -> %d bytes)' % \
         (entry['filepath'].encode(sys.getfilesystemencoding()),
          entry['compsize'], entry['origsize'])
   pathcomponents = entry['filepath'].split(u'/')
      # Paths inside the XP3 use forward slashes as separators
   filepath = dirname
   for elem in pathcomponents:
      if not os.path.isdir(filepath) :   # Create directory if it's not there
         os.mkdir(filepath)              # Won't do this for the final filename
      filepath=os.path.join(filepath,elem.encode(sys.getfilesystemencoding()))
   outbuffer = StringIO()
   adler = zlib.adler32('')  # Initialize checksum for incremental updates
   for segment in entry['segments'] :
      arcfile.seek(segment['offset'])
      if (segment['compressed']) :
         data = zlib.decompress(arcfile.read(segment['compsize']))
      else :
         data = arcfile.read(segment['compsize'])
      assert (len(data) == segment['origsize'])
      outbuffer.write(data)
      adler = zlib.adler32(data,adler)
   if entry['encrypted'] :
      decrypt(entry,outbuffer,encryption)
   if (((adler + 0x0100000000L) & 0x00FFFFFFFFL) != entry['adler']) :
      # Convert to unsigned 32-bit integer
      print 'Checksum error, but continuing...'
   try :
      # Why worry about exceptions?  There's a known problem with archives
      # including a "do not copy this!" file with a huge filename that many
      # filesystems will choke on.  We still want to continue if we hit that.
      print filepath,hex(entry['adler'])
      outfile = open(filepath,'wb')
      outfile.write(outbuffer.getvalue())
      outfile.close()
#      if entry['adler']==0xfb6ceed8:assert 1==2
   except IOError :
      print 'Problems writing %s, but continuing...' % filepath
      outfile = open(dirname+'/that_warning_file.txt','wb')
      outfile.write(outbuffer.getvalue())
      outfile.close()

indexbuffer.close()
arcfile.close()
